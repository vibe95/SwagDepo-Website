(function(b){function a(c){this.settings=b.extend({},b.fn.fbPhotoBox.defaults,c);this.bodyDimension={width:0,height:0};this.bodyDimension.width=b("body").width();this.bodyDimension.height=b("body").height();this.container=b("."+this.settings.containerClassName);this.IsDisplayed=false;this.animateVelocity=3;this.init()}a.prototype={init:function(){var c=this;this.initDOM();this.initSettings();this.rightArrow=b(".right-arrow");this.leftArrow=b(".left-arrow");this.fbpMainImage=b(".fbphotobox-main-image");this.fbpMainContainer=b(".fbphotobox-main-container");this.fbpOverlay=b(".fbphotobox-overlay");this.lazyLoadImage=new Image();this.lazyLoadImage.onload=function(){c.refreshBoxSize(this)};this.fbpMainImage.bind("onFbBoxImageShow",this.settings.onImageShow);b(".fbphotobox-a").hover(function(){b(this).fadeTo("fast",1)},function(){b(this).fadeTo("fast",0.5)});b(".fbphotobox-close-btn a").click(function(){c.hide();return false});b(".fbphotobox-overlay").click(function(){c.hide();return false});b(".fbphotobox-container-left").hover(function(){b(".fbphotobox-image-stage-overlay").fadeIn(c.settings.imageOverlayFadeSpeed)},function(){b(".fbphotobox-image-stage-overlay").fadeOut(c.settings.imageOverlayFadeSpeed)});b("."+this.settings.containerClassName).on("click","."+this.settings.imageClassName,function(){c.show(b(this))});this.leftArrow.click(function(){var d=b("."+c.settings.containerClassName+" ."+c.settings.imageClassName).get(c.leftArrow.attr("data-prev-index"));if(d){c.show(b(d))}});this.rightArrow.click(function(){var d=b("."+c.settings.containerClassName+" ."+c.settings.imageClassName).get(c.rightArrow.attr("data-next-index"));if(d){c.show(b(d))}});b(".fbphotobox-fc-btn").click(function(){c.fullScreenMode=true;c.showFullScreen(c.mainImage);return false});b(".fc-left-arrow .fbphotobox-a").click(function(){c.leftArrow.click();c.showFullScreen(c.mainImage)});b(".fc-right-arrow .fbphotobox-a").click(function(){c.rightArrow.click();c.showFullScreen(c.mainImage)});b(".fbphotobox-fc-close-btn").click(function(){c.fullScreenMode=false;c.hideFullScreen();return false});b(window).resize(function(){c.refreshBoxSize()})},show:function(d){b(".fbphotobox-tag").remove();var c=b("."+this.settings.containerClassName+" ."+this.settings.imageClassName).index(d);this.fbpMainImage.attr("fbp-index",c);this.leftArrow.attr("data-prev-index",c-1);this.rightArrow.attr("data-next-index",c+1);this.fbpMainImage.attr("alt",d.attr("alt"));this.fbpMainImage.posX=d.offset().left;this.fbpMainImage.posY=d.offset().top;this.fbpMainImage.widthSrc=d.width();this.fbpMainImage.heightSrc=d.height();if(d.attr("fbphotobox-src")){this.lazyLoadImage.src=d.attr("fbphotobox-src")}else{this.lazyLoadImage.src=d.attr("src")}},hide:function(){this.IsDisplayed=false;this.lazyLoadImage.src="";var e={posX:this.fbpMainImage.offset().left,posY:this.fbpMainImage.offset().top,widthSrc:this.fbpMainImage.width(),heightSrc:this.fbpMainImage.height()};var d={posX:this.fbpMainImage.posX,posY:this.fbpMainImage.posY,widthSrc:this.fbpMainImage.widthSrc,heightSrc:this.fbpMainImage.heightSrc};var c=b('<img src=""/>').attr("src",this.fbpMainImage.attr("src"));this.fbpMainContainer.fadeOut({easing:"easeOutQuint",queue:false,duration:200});this.fbpOverlay.hide({easing:"easeOutQuint",queue:false,duration:200});this.photoTransitionAnimation(c,e,d,function(){c.remove()});this.displayScroll()},initDOM:function(){var c=['<div class="fbphotobox-main-container">','<div class="fbphotobox-container-left">','<table class="fbphotobox-main-image-table"><tr><td>','<div class="tag-container"><img class="fbphotobox-main-image" src=""/></div>',"</td></tr></table>",'<div class="fbphotobox-image-stage-overlay">','<div class="fbphotobox-container-left-header">','<a title="Full Screen" class="fbphotobox-fc-btn fbphotobox-a"></a>',"</div>",'<div data-prev-index="" class="left-arrow">','<table style="height:100%"><tr><td style="vertical-align:middle;">','<a class="fbphotobox-a" title="Previous"></a>',"</td></tr></table>","</div>",'<div data-next-index="" class="right-arrow">','<table style="height:100%;"><tr><td style="vertical-align:middle;">','<a class="fbphotobox-a" title="Next"></a>',"</td></tr></table>","</div>",'<div class="fbphotobox-container-left-footer">','<div style="margin:20px;">','<span style="font-weight:bold;">Dummy Photo Caption</span>','<span style="color:#B3B3B3;"> in </span>','<span style="font-weight:bold;">Dummy Album Name</span>',"</div>","</div>",'<div class="fbphotobox-container-left-footer-bg"></div>',"</div>","</div>",'<div class="fbphotobox-container-right" >','<div class="fbphotobox-close-btn">','<a title="Close" href="" style="float:right;margin:8px">','<img src="./images/close.png" style="height:10px;width:10px"/>',"</a>",'<div style="clear:both"></div>',"</div>",'<div class="fbphotobox-image-content"></div>',"</div>",'<div style="clear:both"></div>',"</div>","br","br",'<div class="fbphotobox-fc-main-container" style = "padding-top:50px">','<div class="fbphotobox-fc-header" style = "padding-top:50px;padding-bottom:25px">','<div style="float:left">Dummy Header</div>','<a class="fbphotobox-fc-close-btn" href="" >Exit</a>','<div style="clear:both"></div>',"</div>",'<div style="position:fixed;top:0px;right:0px;left:0px;bottom:0px;margin:auto;">','<table style="width:100%;height:100%;text-align:center;">',"<tr>",'<td class="fc-left-arrow" style="width:50px;text-align:center;">','<a class="fbphotobox-a" title="Previous"></a>',"</td>","<td>",'<img class="fbphotobox-fc-main-image" src=""/>',"</td>",'<td class="fc-right-arrow" style="width:50px;text-align:center;">','<a class="fbphotobox-a" title="Next"></a>',"</td>","</tr>","</table>","</div>",'<div class="fbphotobox-fc-footer">Dummy Footer<div style="clear:both"></div></div>',"</div>",'<div class="fbphotobox-overlay"></div>','<div style="clear:both"></div>'];b("body").append(c.join(""));this.settings.afterInitDOM()},initSettings:function(){if(this.settings.rightWidth!=""){b(".fbphotobox-container-right").css("width",this.settings.rightWidth)}if(this.settings.leftBgColor!=""){b(".fbphotobox-container-left").css("backgroundColor",this.settings.leftBgColor)}if(this.settings.rightBgColor!=""){b(".fbphotobox-container-right").css("backgroundColor",this.settings.rightBgColor)}if(this.settings.footerBgColor!=""){b(".fbphotobox-container-left-footer-bg").css("backgroundColor",this.settings.footerBgColor)}if(this.settings.overlayBgColor!=""){b(".fbphotobox-overlay").css("backgroundColor",this.settings.overlayBgColor)}if(this.settings.overlayBgOpacity!=""){b(".fbphotobox-overlay").css("opacity",this.settings.overlayBgOpacity)}},hideScroll:function(){b("body").css({width:b(window).width(),height:b(window).height(),overflow:"hidden"})},displayScroll:function(){b("body").css({width:this.bodyDimension.width,height:this.bodyDimension.height,overflow:"scroll"})},refreshBoxSize:function(d){var e=d==null?false:true;d=d==null?this.lazyLoadImage:d;var h=b(".fbphotobox-container-left");var j=b(".fbphotobox-container-right");var i=d.width;var f=d.height;var m=Math.max(b(window).width()-this.settings.rightWidth-this.settings.normalModeMargin*2,this.settings.minLeftWidth);var n=Math.max(b(window).height()-this.settings.normalModeMargin*2,this.settings.minHeight);if(f<n){h.height(f);this.fbpMainImage.css("max-height",f)}else{h.height(n);this.fbpMainImage.css("max-height",n)}if(i<m){h.width(i);this.fbpMainImage.css("max-width",i)}else{h.width(m);this.fbpMainImage.css("max-width",m)}j.css("height",h.height());b(".fbphotobox-image-content").css("height",h.height()-b(".fbphotobox-close-btn").height());this.fbpMainContainer.css({width:(h.width()+j.width()),height:h.height()});if(e){this.fbpMainImage.attr("src","").attr("src",d.src);b(".fbphotobox-fc-main-image").attr("src","").attr("src",d.src);if(!this.IsDisplayed){if(navigator.appVersion.indexOf("MSIE 7.")!=-1){this.repositionBox()}b(".fbphotobox-overlay").css("opacity",0).show();b(".fbphotobox-main-container").css("opacity",0).show();var l={posX:this.fbpMainImage.posX,posY:this.fbpMainImage.posY,widthSrc:this.fbpMainImage.widthSrc,heightSrc:this.fbpMainImage.heightSrc};var k={posX:this.fbpMainImage.offset().left,posY:this.fbpMainImage.offset().top,widthSrc:this.fbpMainImage.width(),heightSrc:this.fbpMainImage.height()};var c=b('<img src=""/>').attr("src",d.src);this.photoTransitionAnimation(c,l,k,function(){b(".fbphotobox-overlay").animate({opacity:0.9},{easing:"easeOutQuint",queue:false,duration:500});b(".fbphotobox-main-container").animate({opacity:1},{easing:"easeOutQuint",queue:false,duration:500,complete:function(){c.remove()}})});this.IsDisplayed=true}this.fbpMainImage.show(10000,function(){b(this).trigger("onFbBoxImageShow")});var g=parseInt(this.fbpMainImage.attr("fbp-index"));if(g-1<0){this.leftArrow.hide();b(".fc-left-arrow a").hide()}else{this.leftArrow.show();b(".fc-left-arrow a").show()}if(g+1>=b("."+this.settings.containerClassName+" ."+this.settings.imageClassName).length){this.rightArrow.hide();b(".fc-right-arrow a").hide()}else{this.rightArrow.show();b(".fc-right-arrow a").show()}}if(!e){this.refreshTagSize()}},refreshTagSize:function(){var d=b(".fbphotobox-tag");var c=this.fbpMainImage.height();var e=this.fbpMainImage.width();d.each(function(){b(this).css({left:b(this).attr("x")*e,top:b(this).attr("y")*c,width:b(this).attr("w")*e,height:b(this).attr("h")*c})})},refreshFullScreenSize:function(){b(".fbphotobox-fc-main-image").css({"max-width":b(window).width()-b(".fc-left-arrow").width()-b(".fc-right-arrow").width()-20,"max-height":b(window).height()-b(".fbphotobox-fc-header").outerHeight(true)-b(".fbphotobox-fc-footer").outerHeight(true)});b(".fbphotobox-fc-main-image").closest("div").css("height",b(window).height()-b(".fbphotobox-fc-header").outerHeight(true)-b(".fbphotobox-fc-footer").outerHeight(true))},repositionBox:function(){var c=b(".fbphotobox-main-container");var e=(b(window).width()-c.width())/2;var d=(b(window).height()-c.height())/2;b(".fbphotobox-main-container").css({left:e,top:d})},addTags:function(h){var c=this.fbpMainImage.height();var d=this.fbpMainImage.width();var g=b(document.createElement("div")).attr("class","fbphotobox-tag");for(var e=0;e<h.length;e++){var f=g.clone();f.css({position:"absolute",left:(h[e].x*d),top:(h[e].y*c),width:(h[e].w*d),height:(h[e].h*c),zIndex:999}).attr({x:h[e].x,y:h[e].y,w:h[e].w,h:h[e].h});f.appendTo(this.fbpMainImage.closest("div"))}},showFullScreen:function(c){b(".fbphotobox-fc-main-container").show();this.refreshFullScreenSize()},hideFullScreen:function(){b(".fbphotobox-fc-main-container").hide()},photoTransitionAnimation:function(h,j,i,d){var c=j.posX-parseInt(b("body").css("margin-left"));var g=j.posY-parseInt(b("body").css("margin-top"));var f=i.posX-parseInt(b("body").css("margin-left"));var e=i.posY-parseInt(b("body").css("margin-top"));h.css({top:g,left:c,width:j.widthSrc,height:j.heightSrc,position:"absolute",zIndex:999});b("body").append(h);h.animate({top:e,left:f,width:i.widthSrc,height:i.heightSrc},{duration:500,easing:"easeInOutCubic",complete:function(){d()},queue:false})}};b.fn.fbPhotoBox=function(e){var d=Array.prototype.slice.call(arguments,1);var f=b("body");var c=f.data("FBPhotoBox");if(typeof e==="string"){c[e].apply(c,d)}else{f.data("FBPhotoBox",new a(e))}};b.fn.fbPhotoBox.defaults={rightWidth:360,minLeftWidth:520,minHeight:520,leftBgColor:"black",rightBgColor:"white",footerBgColor:"black",overlayBgColor:"black",overlayBgOpacity:0.5,onImageShow:function(){},afterInitDOM:function(){},imageOverlayFadeSpeed:150,normalModeMargin:40,containerClassName:"fbphotobox",imageClassName:"fbphotobox-target-img"}}(jQuery));